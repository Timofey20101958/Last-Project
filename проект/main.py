import telebot
import requests
import time
from telebot.types import ReplyKeyboardMarkup, KeyboardButton, ReplyKeyboardRemove
from config import token1
from collections import defaultdict

user_scores = defaultdict(int)
user_current_question = defaultdict(int)
user_answers = defaultdict(list)

user_last_button = {}
user_button_count = {}
user_blocked_until = {}

TOKEN = token1
bot = telebot.TeleBot(TOKEN)

test_questions = [
    {
        "question": "üöó –ö–∞–∫ —á–∞—Å—Ç–æ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ª–∏—á–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å –¥–ª—è –ø–æ–µ–∑–¥–æ–∫ –ø–æ –≥–æ—Ä–æ–¥—É?",
        "options": [
            "üöó –ï–∂–µ–¥–Ω–µ–≤–Ω–æ",
            "üöå 2-3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é", 
            "üö≤ –†–µ–¥–∫–æ, –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç/–≤–µ–ª–æ—Å–∏–ø–µ–¥",
            "üö∂ –í—Å–µ–≥–¥–∞ –ø–µ—à–∫–æ–º/–Ω–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–µ"
        ],
        "scores": [3, 2, 1, 0]
    },
    {
        "question": "üí° –ò—Å–ø–æ–ª—å–∑—É–µ—à—å –ª–∏ —Ç—ã —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–≥–∞—é—â–∏–µ –ª–∞–º–ø—ã –∏ —Ç–µ—Ö–Ω–∏–∫—É?",
        "options": [
            "üí° –ù–µ—Ç, —Ç–æ–ª—å–∫–æ –æ–±—ã—á–Ω—ã–µ –ª–∞–º–ø—ã",
            "üîå –ß–∞—Å—Ç–∏—á–Ω–æ",
            "‚úÖ –î–∞, –≤–µ–∑–¥–µ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ",
            "üåü –î–∞ + —É–º–Ω—ã–π –¥–æ–º –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏"
        ],
        "scores": [3, 2, 1, 0]
    },
    {
        "question": "üå° –ö–∞–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ —Ç–≤–æ–µ–π –∫–≤–∞—Ä—Ç–∏—Ä–µ –∑–∏–º–æ–π/–ª–µ—Ç–æ–º?",
        "options": [
            "üî• 25¬∞C+ –∑–∏–º–æ–π / 18¬∞C –ª–µ—Ç–æ–π",
            "üå° 22-24¬∞C –∑–∏–º–æ–π / 20-22¬∞C –ª–µ—Ç–æ–π",
            "‚ùÑÔ∏è 20-22¬∞C –∑–∏–º–æ–π / 23-25¬∞C –ª–µ—Ç–æ–π",
            "üåø 18-20¬∞C –∑–∏–º–æ–π / 25¬∞C+ –ª–µ—Ç–æ–π"
        ],
        "scores": [3, 2, 1, 0]
    },
    {
        "question": "üçñ –ö–∞–∫ —á–∞—Å—Ç–æ —Ç—ã –µ—à—å –º—è—Å–æ?",
        "options": [
            "ü•© 2+ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å",
            "üçó 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å",
            "ü•¶ 2-3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é",
            "üå± –í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω–µ—Ü/–≤–µ–≥–∞–Ω"
        ],
        "scores": [3, 2, 1, 0]
    },
    {
        "question": "üõç –ö–∞–∫ —Ç—ã –æ—Ç–Ω–æ—Å–∏—à—å—Å—è –∫ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–º —Ç–æ–≤–∞—Ä–∞–º?",
        "options": [
            "üõç –ß–∞—Å—Ç–æ –ø–æ–∫—É–ø–∞—é –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ",
            "üì¶ –ò–Ω–æ–≥–¥–∞, –∫–æ–≥–¥–∞ —É–¥–æ–±–Ω–æ",
            "üéí –°—Ç–∞—Ä–∞—é—Å—å –∏–∑–±–µ–≥–∞—Ç—å",
            "‚ôªÔ∏è –í—Å–µ–≥–¥–∞ –º–Ω–æ–≥–æ—Ä–∞–∑–æ–≤–æ–µ, zero-waste"
        ],
        "scores": [3, 2, 1, 0]
    },
    {
        "question": "‚úàÔ∏è –ö–∞–∫ —á–∞—Å—Ç–æ —Ç—ã –ª–µ—Ç–∞–µ—à—å –Ω–∞ —Å–∞–º–æ–ª–µ—Ç–µ?",
        "options": [
            "‚úàÔ∏è 3+ —Ä–∞–∑–∞ –≤ –≥–æ–¥",
            "üõ´ 1-2 —Ä–∞–∑–∞ –≤ –≥–æ–¥",
            "üöÜ –†–∞–∑ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–µ—Ç",
            "üöÇ –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ª–µ—Ç–∞—é"
        ],
        "scores": [3, 2, 1, 0]
    },
    {
        "question": "üóë –°–æ—Ä—Ç–∏—Ä—É–µ—à—å –ª–∏ —Ç—ã –º—É—Å–æ—Ä?",
        "options": [
            "üóë –ù–µ—Ç",
            "üìä –ò–Ω–æ–≥–¥–∞",
            "‚ôªÔ∏è –î–∞, –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",
            "üåç –î–∞ + –∫–æ–º–ø–æ—Å—Ç–∏—Ä—É—é –æ—Ä–≥–∞–Ω–∏–∫—É"
        ],
        "scores": [3, 2, 1, 0]
    },
    {
        "question": "üöø –ö–∞–∫ –¥–æ–ª–≥–æ —Ç—ã –ø—Ä–∏–Ω–∏–º–∞–µ—à—å –¥—É—à?",
        "options": [
            "üöø 15+ –º–∏–Ω—É—Ç",
            "‚è±Ô∏è 10-15 –º–∏–Ω—É—Ç",
            "üïí 5-10 –º–∏–Ω—É—Ç",
            "‚ö°Ô∏è –î–æ 5 –º–∏–Ω—É—Ç"
        ],
        "scores": [3, 2, 1, 0]
    },
    {
        "question": "üì± –ß–∞—Å—Ç–æ –ª–∏ —Ç—ã –º–µ–Ω—è–µ—à—å –≥–∞–¥–∂–µ—Ç—ã?",
        "options": [
            "üì± –ö–∞–∂–¥—ã–π –≥–æ–¥ –Ω–æ–≤—ã–µ",
            "üíª –†–∞–∑ –≤ 2 –≥–æ–¥–∞",
            "üñ• –†–∞–∑ –≤ 3-4 –≥–æ–¥–∞",
            "üîß –ü–æ–∫–∞ –Ω–µ —Å–ª–æ–º–∞—é—Ç—Å—è"
        ],
        "scores": [3, 2, 1, 0]
    },
    {
        "question": "üå± –£—á–∞—Å—Ç–≤—É–µ—à—å –ª–∏ –≤ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞—Ö?",
        "options": [
            "‚ùå –ù–µ—Ç",
            "ü§î –ò–Ω–æ–≥–¥–∞ —á–∏—Ç–∞—é –æ–± —ç—Ç–æ–º",
            "üëç –ü–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ —ç–∫–æ-–±–ª–æ–≥–∏",
            "üå± –£—á–∞—Å—Ç–≤—É—é –≤ –∞–∫—Ü–∏—è—Ö + –ø—Ä–æ—Å–≤–µ—â–∞—é –¥—Ä—É–≥–∏—Ö"
        ],
        "scores": [3, 2, 1, 0]
    }
]
def check_spam_simple(user_id, button_text):
    import time
    
    current_time = time.time()
    
    if user_id in user_blocked_until:
        if current_time < user_blocked_until[user_id]:
            return True
        else:
            del user_blocked_until[user_id]
            if user_id in user_last_button:
                del user_last_button[user_id]
            if user_id in user_button_count:
                del user_button_count[user_id]
    
    if user_id in user_last_button and user_last_button[user_id] == button_text:
        user_button_count[user_id] += 1
    else:
        user_last_button[user_id] = button_text
        user_button_count[user_id] = 1
    
    if user_button_count[user_id] >= 5:
        user_blocked_until[user_id] = current_time + 300
        return True
    
    return False

def safe_send_message(chat_id, text, kwargs):
    try:
        return bot.send_message(chat_id, text, **kwargs)
    except requests.exceptions.ConnectionError:
        print("‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è")
        return None
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: {e}")
        return None
    

def main_keyboard():
    keyboard = ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)
    
    button1 = KeyboardButton("üåç –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–∏")
    button2 = KeyboardButton("üî• –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ")
    button3 = KeyboardButton("üîß –°–ø–æ—Å–æ–±—ã —É–ª—É—á—à–µ–Ω–∏—è")
    button4 = KeyboardButton("üìä –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ")
    button5 = KeyboardButton("üìà –¢–µ—Å—Ç: –ú–æ–µ –≤–ª–∏—è–Ω–∏–µ")
    button8 = KeyboardButton("üõ†–ü–æ–¥–¥–µ—Ä–∂–∫–∞")
    button6 = KeyboardButton("üÜò –ü–æ–º–æ—â—å")
    button7 = KeyboardButton("‚ùå –°–∫—Ä—ã—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É")
    
    keyboard.add(button1, button2, button3, button4, button5, button6, button8, button7)
    return keyboard

def ways_keyboard():
    keyboard = ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)
    
    button1 = KeyboardButton("üîã –°–Ω–∏–∂–µ–Ω–∏–µ –≤—ã–±—Ä–æ—Å–æ–≤")
    button2 = KeyboardButton("üå≥ –ó–∞—â–∏—Ç–∞ –ª–µ—Å–æ–≤")
    button3 = KeyboardButton("üìö –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ")
    button4 = KeyboardButton("‚ö°Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏")
    button5 = KeyboardButton("üóë –£–º–µ–Ω—å—à–µ–Ω–∏–µ –æ—Ç—Ö–æ–¥–æ–≤")
    button6 = KeyboardButton("üèò –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã")
    button7 = KeyboardButton("üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é")
    
    keyboard.add(button1, button2, button3, button4, button5, button6, button7)
    return keyboard

def get_personal_advice(answers):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–æ–≤"""
    advice = ""
    
    # 1. –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
    if "üöó –ï–∂–µ–¥–Ω–µ–≤–Ω–æ" in answers:
        advice += "‚Ä¢ –ü–æ–ø—Ä–æ–±—É–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç 2-3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é üöå\n"
    elif "üöå 2-3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é" in answers:
        advice += "‚Ä¢ –û—Ç–ª–∏—á–Ω—ã–π —Å—Ç–∞—Ä—Ç! –ü–æ–ø—Ä–æ–±—É–π —É–≤–µ–ª–∏—á–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –¥–æ 4-5 —Ä–∞–∑ üöç\n"
    elif "üö≤ –†–µ–¥–∫–æ, –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç/–≤–µ–ª–æ—Å–∏–ø–µ–¥" in answers:
        advice += "‚Ä¢ –°—É–ø–µ—Ä! –ü—Ä–æ–¥–æ–ª–∂–∞–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–∫–æ–ª–æ–≥–∏—á–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç üåø\n"
    
    # 2. –≠–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ
    if "üí° –ù–µ—Ç, —Ç–æ–ª—å–∫–æ –æ–±—ã—á–Ω—ã–µ –ª–∞–º–ø—ã" in answers:
        advice += "‚Ä¢ –ó–∞–º–µ–Ω–∏ –ª–∞–º–ø—ã –Ω–∞–∫–∞–ª–∏–≤–∞–Ω–∏—è –Ω–∞ —Å–≤–µ—Ç–æ–¥–∏–æ–¥–Ω—ã–µ - —ç–∫–æ–Ω–æ–º–∏—è –¥–æ 80% —ç–Ω–µ—Ä–≥–∏–∏ üí°\n"
    elif "üîå –ß–∞—Å—Ç–∏—á–Ω–æ" in answers:
        advice += "‚Ä¢ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∑–∞–º–µ–Ω—è–π –≤—Å—é —Ç–µ—Ö–Ω–∏–∫—É –Ω–∞ —ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é –∫–ª–∞—Å—Å –ê+ ‚ö°Ô∏è\n"
    
    # 3. –û—Ç–æ–ø–ª–µ–Ω–∏–µ/–æ—Ö–ª–∞–∂–¥–µ–Ω–∏–µ
    if "üî• 25¬∞C+ –∑–∏–º–æ–π / 18¬∞C –ª–µ—Ç–æ–π" in answers:
        advice += "‚Ä¢ –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 20-22¬∞C –∑–∏–º–æ–π –∏ 24-25¬∞C –ª–µ—Ç–æ–π üå°\n"
    elif "üå° 22-24¬∞C –∑–∏–º–æ–π / 20-22¬∞C –ª–µ—Ç–æ–π" in answers:
        advice += "‚Ä¢ –û—Ç–ª–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏! –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 1¬∞C —ç–∫–æ–Ω–æ–º–∏—Ç 5-7% —ç–Ω–µ—Ä–≥–∏–∏ ‚ùÑÔ∏è\n"
    
    # 4. –ü–∏—Ç–∞–Ω–∏–µ
    if "ü•© 2+ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å" in answers:
        advice += "‚Ä¢ –ü–æ–ø—Ä–æ–±—É–π –≤–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–∏–µ –¥–Ω–∏ 2-3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é ü•¶\n"
    elif "üçó 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å" in answers:
        advice += "‚Ä¢ –û—Ç–ª–∏—á–Ω–æ! –ú–æ–∂–µ—à—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –º—è—Å—É üå±\n"
    elif "ü•¶ 2-3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é" in answers:
        advice += "‚Ä¢ –ò–¥–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å! –†–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–µ—Ç–∞ —Å–Ω–∏–∂–∞–µ—Ç —É–≥–ª–µ—Ä–æ–¥–Ω—ã–π —Å–ª–µ–¥ –Ω–∞ 50% ü•¨\n"
    
    # 5. –ü–æ–∫—É–ø–∫–∏
    if "üõç –ß–∞—Å—Ç–æ –ø–æ–∫—É–ø–∞—é –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ" in answers:
        advice += "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π –º–Ω–æ–≥–æ—Ä–∞–∑–æ–≤—ã–µ —Å—É–º–∫–∏, –±—É—Ç—ã–ª–∫–∏ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã üéí\n"
    elif "üì¶ –ò–Ω–æ–≥–¥–∞, –∫–æ–≥–¥–∞ —É–¥–æ–±–Ω–æ" in answers:
        advice += "‚Ä¢ –ù–æ—Å–∏ —Å —Å–æ–±–æ–π —ç–∫–æ-—Å—É–º–∫—É - —ç—Ç–æ —É–¥–æ–±–Ω–æ –∏ —ç–∫–æ–ª–æ–≥–∏—á–Ω–æ ‚ôªÔ∏è\n"
    
    # 6. –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è
    if "‚úàÔ∏è 3+ —Ä–∞–∑–∞ –≤ –≥–æ–¥" in answers:
        advice += "‚Ä¢ –†–∞—Å—Å–º–æ—Ç—Ä–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã: –ø–æ–µ–∑–¥–∞ –≤–º–µ—Å—Ç–æ —Å–∞–º–æ–ª–µ—Ç–æ–≤ –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è üöÜ\n"
    elif "üõ´ 1-2 —Ä–∞–∑–∞ –≤ –≥–æ–¥" in answers:
        advice += "‚Ä¢ –û—Ç–ª–∏—á–Ω—ã–π –±–∞–ª–∞–Ω—Å! –í—ã–±–∏—Ä–∞–π –ø—Ä—è–º—ã–µ —Ä–µ–π—Å—ã - –æ–Ω–∏ —ç–∫–æ–ª–æ–≥–∏—á–Ω–µ–µ ‚úàÔ∏è\n"
    
    # 7. –û—Ç—Ö–æ–¥—ã
    if "üóë –ù–µ—Ç" in answers:
        advice += "‚Ä¢ –ù–∞—á–Ω–∏ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–ª–∞—Å—Ç–∏–∫–∞ –∏ –±—É–º–∞–≥–∏ - —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ! üìä\n"
    elif "üìä –ò–Ω–æ–≥–¥–∞" in answers:
        advice += "‚Ä¢ –°–¥–µ–ª–∞–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –º—É—Å–æ—Ä–∞ –ø—Ä–∏–≤—ã—á–∫–æ–π - –ø–æ—Å—Ç–∞–≤—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã üóÇ\n"
    elif "‚ôªÔ∏è –î–∞, –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" in answers:
        advice += "‚Ä¢ –û—Ç–ª–∏—á–Ω–æ! –ú–æ–∂–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–æ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∫–∏ üåç\n"
    
    # 8. –í–æ–¥–∞
    if "üöø 15+ –º–∏–Ω—É—Ç" in answers:
        advice += "‚Ä¢ –°–æ–∫—Ä–∞—Ç–∏ –≤—Ä–µ–º—è –¥—É—à–∞ –¥–æ 5-7 –º–∏–Ω—É—Ç - —Å—ç–∫–æ–Ω–æ–º–∏—à—å –≤–æ–¥—É –∏ —ç–Ω–µ—Ä–≥–∏—é ‚è±Ô∏è\n"
    elif "‚è±Ô∏è 10-15 –º–∏–Ω—É—Ç" in answers:
        advice += "‚Ä¢ –û—Ç–ª–∏—á–Ω–æ! –£—Å—Ç–∞–Ω–æ–≤–∏ —ç–∫–æ–Ω–æ–º–∏—á–Ω—É—é –¥—É—à–µ–≤—É—é –ª–µ–π–∫—É –¥–ª—è –µ—â–µ –±–æ–ª—å—à–µ–π —ç–∫–æ–Ω–æ–º–∏–∏ üíß\n"
    elif "üïí 5-10 –º–∏–Ω—É—Ç" in answers:
        advice += "‚Ä¢ –ò–¥–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è! –ó–∞–∫—Ä—ã–≤–∞–π –∫—Ä–∞–Ω, –∫–æ–≥–¥–∞ –Ω–∞–º—ã–ª–∏–≤–∞–µ—à—å—Å—è üö∞\n"
    
    # 9. –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞
    if "üì± –ö–∞–∂–¥—ã–π –≥–æ–¥ –Ω–æ–≤—ã–µ" in answers:
        advice += "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π —Ç–µ—Ö–Ω–∏–∫—É 2-3 –≥–æ–¥–∞ - —ç—Ç–æ —ç–∫–æ–ª–æ–≥–∏—á–Ω–æ –∏ —ç–∫–æ–Ω–æ–º–∏—á–Ω–æ üíª\n"
    elif "üíª –†–∞–∑ –≤ 2 –≥–æ–¥–∞" in answers:
        advice += "‚Ä¢ –û—Ç–ª–∏—á–Ω–æ! –°–ª–µ–¥—É—é—â–∏–π –≥–∞–¥–∂–µ—Ç –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—â–µ –¥–æ–ª—å—à–µ üì±\n"
    
    # 10. –≠–∫–æ-–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
    if "‚ùå –ù–µ—Ç" in answers:
        advice += "‚Ä¢ –ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ —ç–∫–æ-–±–ª–æ–≥–∏ - —É–∑–Ω–∞–µ—à—å –º–Ω–æ–≥–æ –ø–æ–ª–µ–∑–Ω–æ–≥–æ üìö\n"
    elif "ü§î –ò–Ω–æ–≥–¥–∞ —á–∏—Ç–∞—é –æ–± —ç—Ç–æ–º" in answers:
        advice += "‚Ä¢ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ –º–µ—Å—Ç–Ω—ã–º —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞–º üåü\n"
    elif "üëç –ü–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ —ç–∫–æ-–±–ª–æ–≥–∏" in answers:
        advice += "‚Ä¢ –û—Ç–ª–∏—á–Ω–æ! –ü–æ–¥–µ–ª–∏—Å—å –∑–Ω–∞–Ω–∏—è–º–∏ —Å –¥—Ä—É–∑—å—è–º–∏ - –≤–¥–æ—Ö–Ω–æ–≤–∏ –∏—Ö üë•\n"
    
    return advice if advice else "‚Ä¢ –¢—ã —É–∂–µ –¥–µ–ª–∞–µ—à—å –º–Ω–æ–≥–æ–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ! –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ! ‚ú®"

def cancel_test(message):
    """–û—Ç–º–µ–Ω–∞ —Ç–µ—Å—Ç–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    user_id = message.from_user.id
    
    if user_id in user_scores:
        del user_scores[user_id]
    if user_id in user_current_question:
        del user_current_question[user_id]
    if user_id in user_answers:
        del user_answers[user_id]
    
    bot.send_message(
        message.chat.id,
        "‚ùå –¢–µ—Å—Ç –æ—Ç–º–µ–Ω–µ–Ω. –í–æ–∑–≤—Ä–∞—â–∞—é –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é...",
        reply_markup=main_keyboard()
    )

def handle_test_answer(message):
    user_id = message.from_user.id
    current_q = user_current_question[user_id]
    
    if current_q >= len(test_questions):
        return
    
    question_data = test_questions[current_q]
    user_answer = message.text
    
    if user_answer in question_data['options']:
        option_index = question_data['options'].index(user_answer)
        user_scores[user_id] += question_data['scores'][option_index]
        user_answers[user_id].append(user_answer)
        
        user_current_question[user_id] += 1
        ask_question(message)
    
    elif user_answer == "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ—Å—Ç":
        cancel_test(message)

def ask_question(message):
    user_id = message.from_user.id
    current_q = user_current_question[user_id]
    
    if current_q >= len(test_questions):
        show_results(message)
        return
    
    question_data = test_questions[current_q]
    
    keyboard = ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)
    for option in question_data['options']:
        keyboard.add(KeyboardButton(option))
    keyboard.add(KeyboardButton("‚ùå –û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ—Å—Ç"))
    
    bot.send_message(
        message.chat.id,
        f"**–í–æ–ø—Ä–æ—Å {current_q + 1}/{len(test_questions)}:**\n{question_data['question']}",
        reply_markup=keyboard,
        parse_mode="Markdown"
    )

def show_results(message):
    user_id = message.from_user.id
    total_score = user_scores[user_id]
    max_score = 30
    if total_score <= 10:
        result = "üåü –≠–∫–æ-–≥–µ—Ä–æ–π!"
        description = "–¢–≤–æ–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏ –ø–æ—á—Ç–∏ –Ω–µ –≤—Ä–µ–¥–∏—Ç –ø–ª–∞–Ω–µ—Ç–µ! –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ! üéâ"
    elif total_score <= 20:
        result = "‚úÖ –û—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å"
        description = "–¢—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏! –ï—Å—Ç—å –∫—É–¥–∞ —Ä–∞—Å—Ç–∏, –Ω–æ —Ç—ã —É–∂–µ –º–Ω–æ–≥–æ–µ –¥–µ–ª–∞–µ—à—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ! üëç"
    elif total_score <= 25:
        result = "‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ–µ –≤–ª–∏—è–Ω–∏–µ"
        description = "–°—Ç–æ–∏—Ç –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏. –ú–∞–ª–µ–Ω—å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–≥—É—Ç –¥–∞—Ç—å –±–æ–ª—å—à–æ–π —ç—Ñ—Ñ–µ–∫—Ç! üí™"
    else:
        result = "üö® –í—ã—Å–æ–∫–æ–µ –≤–ª–∏—è–Ω–∏–µ"
        description = "–°—Ä–æ—á–Ω–æ –º–µ–Ω—è–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏! –ö–∞–∂–¥—ã–π —Ç–≤–æ–π —à–∞–≥ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–ª–∞–Ω–µ—Ç—É üåç"

    bot.send_message(
        message.chat.id,
        f"üìä **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞:**\n\n"
        f"**–¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {total_score}/{max_score} –±–∞–ª–ª–æ–≤**\n"
        f"**–û—Ü–µ–Ω–∫–∞: {result}**\n\n"
        f"{description}\n\n"
        f"üí° **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã:**\n"
        f"{get_personal_advice(user_answers[user_id])}",
        reply_markup=main_keyboard(),
        parse_mode="Markdown"
    )
    
    clean_test_data(user_id)

def clean_test_data(user_id):
    if user_id in user_scores:
        del user_scores[user_id]
    if user_id in user_current_question:
        del user_current_question[user_id]
    if user_id in user_answers:
        del user_answers[user_id]

@bot.message_handler(commands=['start'])
def start_command(message):
    keyboard = main_keyboard()
    safe_send_message(
        message.chat.id,
        """–ü—Ä–∏–≤–µ—Ç! üòä –Ø —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –±–æ—Ç üå±, —è –ø–æ–º–æ–≥—É –≤–∞–º —É–∑–Ω–∞—Ç—å –æ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö üè≠ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è—Ö üí°!

–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é –∏–∑ –º–µ–Ω—é –Ω–∏–∂–µ: üëá""",
        reply_markup=keyboard
    )

@bot.message_handler(commands=['help'])
def help_command(message):
    keyboard = main_keyboard()
    safe_send_message(
        message.chat.id,
        """–í–æ—Ç –∫–æ–º–∞–Ω–¥—ã –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç: üìã

/start - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ üëã
/help - –≤—ã–∑–æ–≤ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã ‚ùì
/info - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–∏ üå°üåç
/global_warming - —á—Ç–æ —Ç–∞–∫–æ–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ üî•
/warming_now - –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ üìä
/ways_to_improve - –ø—É—Ç–∏ —É–ª—É—á—à–µ–Ω–∏—è —ç–∫–æ–ª–æ–≥–∏–∏ ‚ôªÔ∏è
/keyboard - –ø–æ–∫–∞–∑–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É ‚å®Ô∏è
/quest - –Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç "–ú–æ—ë –≤–ª–∏—è–Ω–∏–µ" ‚úîÔ∏è

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é! üéõ""",
        reply_markup=keyboard
    )

@bot.message_handler(commands=['keyboard'])
def show_keyboard(message):
    keyboard = main_keyboard()
    safe_send_message(
        message.chat.id,
        "–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é: üëá",
        reply_markup=keyboard
    )

@bot.message_handler(commands=['hide'])
def hide_keyboard(message):
    safe_send_message(
        message.chat.id,
        "–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–∫—Ä—ã—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /keyboard —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å –µ—ë. ‚å®Ô∏è",
        reply_markup=ReplyKeyboardRemove()
    )

@bot.message_handler(commands=['info'])
def info1_command(message):
    keyboard = main_keyboard()
    safe_send_message(
        message.chat.id,
        """–í—ã–±–µ—Ä–∏ –∫–∞–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Ö–æ—á–µ—à—å –ø–æ–ª—É—á–∏—Ç—å: ü§î

–ù–∞–∂–º–∏—Ç–µ "üî• –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ" —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —á—Ç–æ —Ç–∞–∫–æ–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ üåçüî•

–ù–∞–∂–º–∏—Ç–µ "üìä –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ" —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –æ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–∏ üìäüå°""",
        reply_markup=keyboard
    )

@bot.message_handler(commands=['helps'])
def helps_command(message):
    keyboard = main_keyboard()
    safe_send_message(
        message.chat.id,
        """–í–æ—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã
@ilyagolovin""",
        reply_markup=keyboard,
        parse_mode="Markdown"
    )

@bot.message_handler(commands=['global_warming'])
def global_warming_command(message):
    keyboard = main_keyboard()
    safe_send_message(
        message.chat.id,
        """
üåç **–ì–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ üî•

–ì–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –ó–µ–º–ª–∏ üå° –∏–∑-–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ —Ç–µ–ø–ª–∞ –≤ –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ. ‚òÄÔ∏èüî•

–û–Ω–æ —Å–≤—è–∑–∞–Ω–æ —Å —É—Å–∏–ª–µ–Ω–∏–µ–º –ø–∞—Ä–Ω–∏–∫–æ–≤–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞: —á–∞—Å—Ç—å —Å–æ–ª–Ω–µ—á–Ω–æ–≥–æ –∏–∑–ª—É—á–µ–Ω–∏—è, –Ω–∞–≥—Ä–µ–≤–∞—é—â–µ–≥–æ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –ø–ª–∞–Ω–µ—Ç—ã, –∑–∞–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–º–∏ –≥–∞–∑–∞–º–∏ –∏ –Ω–µ —É—Ö–æ–¥–∏—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ –∫–æ—Å–º–æ—Å. üõ∞‚ùå

–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
‚Ä¢ –°–∂–∏–≥–∞–Ω–∏–µ –∏—Å–∫–æ–ø–∞–µ–º–æ–≥–æ —Ç–æ–ø–ª–∏–≤–∞ üõ¢
‚Ä¢ –í—ã—Ä—É–±–∫–∞ –ª–µ—Å–æ–≤ üå≥
‚Ä¢ –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–µ –≤—ã–±—Ä–æ—Å—ã üè≠
‚Ä¢ –°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ üöú

–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:
‚Ä¢ –¢–∞—è–Ω–∏–µ –ª–µ–¥–Ω–∏–∫–æ–≤ üßä
‚Ä¢ –ü–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –º–æ—Ä—è üåä
‚Ä¢ –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –ø–æ–≥–æ–¥–Ω—ã–µ —è–≤–ª–µ–Ω–∏—è ‚õà
‚Ä¢ –£–≥—Ä–æ–∑–∞ –±–∏–æ—Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—é üêæ
–î–ª—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–æ–∂–µ—Ç–µ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è –∑–¥–µ—Å—å - https://yandex.ru/pogoda/ru/blog/globalnoe-poteplenie üìöüîç""",
        reply_markup=keyboard,
        parse_mode="Markdown"
    )

@bot.message_handler(commands=['warming_now'])
def warming_now_command(message):
    keyboard = main_keyboard()
    safe_send_message(
        message.chat.id,
        """
üìä –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–ª–æ–±–∞–ª—å–Ω–æ–º –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–∏ üå°

–ü–æ –¥–∞–Ω–Ω—ã–º –Ω–∞ 2025 –≥–æ–¥, –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ –≤–ø–ª–æ—Ç–Ω—É—é –ø—Ä–∏–±–ª–∏–∑–∏–ª–æ—Å—å –∫ –æ—Ç–º–µ—Ç–∫–µ –≤ 1,5 –≥—Ä–∞–¥—É—Å–∞ –¶–µ–ª—å—Å–∏—è ‚ö†Ô∏è ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º—É –ø–æ—Ä–æ–≥—É, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞ –ó–µ–º–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —Ü–µ–ø–æ—á–∫–∞ –º–∞—Å—à—Ç–∞–±–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, –≥—Ä–æ–∑—è—â–∞—è —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ–º –≤—Å–µ–≥–æ –∂–∏–≤–æ–≥–æ –Ω–∞ –ø–ª–∞–Ω–µ—Ç–µ. üíîüî•

–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:
‚Ä¢ üå° –ü–æ–≤—ã—à–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã: +1.2¬∞C —Å –¥–æ–∏–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
‚Ä¢ ‚òÅÔ∏è –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è CO‚ÇÇ –≤ –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ: 420 ppm (—Ä–µ–∫–æ—Ä–¥–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å)
‚Ä¢ üßä –¢–∞—è–Ω–∏–µ –ª–µ–¥–Ω–∏–∫–æ–≤: —Å–∫–æ—Ä–æ—Å—Ç—å —É–≤–µ–ª–∏—á–∏–ª–∞—Å—å –Ω–∞ 65% –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ª–µ—Ç
‚Ä¢ üåä –ü–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –º–æ—Ä—è: +20 —Å–º —Å 1900 –≥–æ–¥–∞
‚Ä¢ ‚õà –£—á–∞—â–µ–Ω–∏–µ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –ø–æ–≥–æ–¥–Ω—ã—Ö —è–≤–ª–µ–Ω–∏–π: –Ω–∞ 30% –∑–∞ 20 –ª–µ—Ç

–ü—Ä–æ–≥–Ω–æ–∑—ã —É—á–µ–Ω—ã—Ö:
‚Ä¢ –ö 2030 –≥–æ–¥—É –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–∞ –≤ 1.5¬∞C üìà
‚Ä¢ –ö 2050 –≥–æ–¥—É - –¥–æ 2.0¬∞C, –µ—Å–ª–∏ –Ω–µ –ø—Ä–∏–Ω—è—Ç—å –º–µ—Ä—ã ‚ö†Ô∏è
‚Ä¢ –†–∏—Å–∫ –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã üåç

–î–ª—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–æ–∂–µ—Ç–µ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è –∑–¥–µ—Å—å - https://ria.ru/20251118/warming-2055051661.html üìäüîç""",
        reply_markup=keyboard,
        parse_mode="Markdown"
    )

@bot.message_handler(commands=['ways_to_improve'])
def ways_to_improve_command(message):
    keyboard = ways_keyboard()
    safe_send_message(
        message.chat.id,
        """
‚ôªÔ∏è –ü—É—Ç–∏ —É–ª—É—á—à–µ–Ω–∏—è —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ üå±

–ß–µ–ª–æ–≤–µ–∫ –º–æ–∂–µ—Ç —É–ª—É—á—à–∏—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ–º üåçüî•, —Å–æ–∫—Ä–∞—Ç–∏–≤ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ üíß‚ö°Ô∏è, –ø–æ–≤—ã—Å–∏–≤ —ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å üí°‚úÖ –∏ —Å–Ω–∏–∑–∏–≤ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –Ω–∞ –æ–∫—Ä—É–∂–∞—é—â—É—é —Å—Ä–µ–¥—É üöó‚û°Ô∏èüö≤.

–¢–∞–∫–∂–µ –≤–∞–∂–Ω–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –∑–Ω–∞–Ω–∏—è –æ –∫–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∏ –∏—Ö –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è—Ö üìöüå±‚ú®.

–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: üëá""",
        reply_markup=keyboard,
        parse_mode="Markdown"
    )

@bot.message_handler(commands=['ways'])
def ways_command(message):
    keyboard = ways_keyboard()
    safe_send_message(
        message.chat.id,
        "üîß –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —ç–∫–æ–ª–æ–≥–∏–∏: üëá",
        reply_markup=keyboard,
        parse_mode="Markdown"
    )

@bot.message_handler(commands=['quest'])
def start_test_command(message):
    user_id = message.from_user.id

    user_scores[user_id] = 0
    user_current_question[user_id] = 0
    user_answers[user_id] = []
    
    bot.send_message(
        message.chat.id,
        "üìä –ù–∞—á–Ω–µ–º —Ç–µ—Å—Ç!**\n\n–û—Ç–≤–µ—Ç—å –Ω–∞ 10 –≤–æ–ø—Ä–æ—Å–æ–≤ –æ —Å–≤–æ–µ–º –æ–±—Ä–∞–∑–µ –∂–∏–∑–Ω–∏ üéØ",
        parse_mode="Markdown"
    )
    ask_question(message)

@bot.message_handler(func=lambda message: True)
def handle_buttons(message):
    try:
        user_id = message.from_user.id
        text = message.text
        
        
        if check_spam_simple(user_id, text):
            if user_id in user_blocked_until:
                import time
                current_time = time.time()
                time_left = int(user_blocked_until[user_id] - current_time)
                minutes = time_left // 60
                seconds = time_left % 60
                
                
                if time_left > 0:
                    bot.send_message(
                        message.chat.id,
                        f"‚ö†Ô∏è –í—ã –Ω–∞–∂–∏–º–∞–µ—Ç–µ –∫–Ω–æ–ø–∫–∏ —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ!\n"
                        f"‚è≥ –ü–æ–¥–æ–∂–¥–∏—Ç–µ {minutes} –º–∏–Ω—É—Ç {seconds} —Å–µ–∫—É–Ω–¥\n"
                        f"üìå –°–æ–≤–µ—Ç: –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é –∫–Ω–æ–ø–∫—É!"
                    )
            return

        if user_id in user_current_question and user_current_question[user_id] < len(test_questions):
            handle_test_answer(message)
            return
        if text == "üåç –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–∏":
            info1_command(message)
        elif text == "üî• –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ":
            global_warming_command(message)
        elif text == "üîß –°–ø–æ—Å–æ–±—ã —É–ª—É—á—à–µ–Ω–∏—è":
            ways_command(message)
        elif text == "üìä –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ":
            warming_now_command(message)
        elif text == "üõ†–ü–æ–¥–¥–µ—Ä–∂–∫–∞":
            helps_command(message)
        elif text == "üÜò –ü–æ–º–æ—â—å":
            help_command(message)
        elif text == "üìà –¢–µ—Å—Ç: –ú–æ–µ –≤–ª–∏—è–Ω–∏–µ":
            start_test_command(message)
        elif text == "‚ùå –°–∫—Ä—ã—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É":
            hide_keyboard(message)
        elif text == "üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é":
            start_command(message)
        elif text == "üîã –°–Ω–∏–∂–µ–Ω–∏–µ –≤—ã–±—Ä–æ—Å–æ–≤":
            try:
                img1 = open("1.jpg", "rb")
                bot.send_photo(message.chat.id, img1)
            except:
                pass
            safe_send_message(
                message.chat.id,
                """
üîã **–°–Ω–∏–∂–µ–Ω–∏–µ –≤—ã–±—Ä–æ—Å–æ–≤ –ø–∞—Ä–Ω–∏–∫–æ–≤—ã—Ö –≥–∞–∑–æ–≤ üåç‚¨áÔ∏è

–ú–µ—Ä—ã –ø–æ —Å–Ω–∏–∂–µ–Ω–∏—é:
‚Ä¢ –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º—É—é —ç–Ω–µ—Ä–≥–∏—é ‚òÄÔ∏èüí®üíß
‚Ä¢ –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏—Å–∫–æ–ø–∞–µ–º–æ–≥–æ —Ç–æ–ø–ª–∏–≤–∞ üõ¢üîª
‚Ä¢ –≠–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ üí°
‚Ä¢ –≠–∫–æ–ª–æ–≥–∏—á–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç üöó‚û°Ô∏èüö≤

–ö–∞–∂–¥—ã–π –º–æ–∂–µ—Ç:
‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç üöå
‚Ä¢ –£—Ç–µ–ø–ª–∏—Ç—å –¥–æ–º üè†
‚Ä¢ –í—ã–±–∏—Ä–∞—Ç—å —ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–±–æ—Ä—ã üîå""",
                reply_markup=ways_keyboard(),
                parse_mode="Markdown"
            )
        elif text == "üå≥ –ó–∞—â–∏—Ç–∞ –ª–µ—Å–æ–≤":
            try:
                img2 = open("2.jpg", "rb")
                bot.send_photo(message.chat.id, img2)
            except:
                pass
            safe_send_message(
                message.chat.id,
                """
üå≥ –ó–∞—â–∏—Ç–∞ –ª–µ—Å–æ–≤ üõ°

–õ–µ—Å–∞ ‚Äî –ª–µ–≥–∫–∏–µ –Ω–∞—à–µ–π –ø–ª–∞–Ω–µ—Ç—ã! –û–Ω–∏ –ø–æ–≥–ª–æ—â–∞—é—Ç CO‚ÇÇ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç –∫–∏—Å–ª–æ—Ä–æ–¥ üåø‚òÅÔ∏è‚û°Ô∏èüåø‚úÖ

–í–∞–∂–Ω–æ—Å—Ç—å –∑–∞—â–∏—Ç—ã:
‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–∏–æ—Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è üêæ
‚Ä¢ –†–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–º–∞—Ç–∞ üåç
‚Ä¢ –ó–∞—â–∏—Ç–∞ –æ—Ç —ç—Ä–æ–∑–∏–∏ –ø–æ—á–≤ üå±

–ö–∞–∫ –ø–æ–º–æ—á—å:
‚Ä¢ –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –ø–æ—Å–∞–¥–∫–∞—Ö –¥–µ—Ä–µ–≤—å–µ–≤ üå±
‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ –∑–∞—â–∏—Ç–µ –ª–µ—Å–æ–≤ ü§ù
‚Ä¢ –°–æ–∫—Ä–∞—â–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±—É–º–∞–≥–∏ üìÑ""",
                reply_markup=ways_keyboard(),
                parse_mode="Markdown"
            )
        elif text == "üìö –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ":
            try:
                img3 = open("3.jpg", "rb")
                bot.send_photo(message.chat.id, img3)
            except:
                pass
            safe_send_message(
                message.chat.id,
                """
üìö –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏–µ üéì‚ú®

–ó–Ω–∞–Ω–∏–µ ‚Äî —Å–∏–ª–∞ –≤ –±–æ—Ä—å–±–µ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∫–ª–∏–º–∞—Ç–∞! üë•üåçüí™

–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:
‚Ä¢ –≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏–µ –≤ —à–∫–æ–ª–∞—Ö üè´
‚Ä¢ –û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ª–µ–∫—Ü–∏–∏ –∏ —Å–µ–º–∏–Ω–∞—Ä—ã üé§
‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏ –≤ –°–ú–ò üì∫
‚Ä¢ –û–Ω–ª–∞–π–Ω-–∫—É—Ä—Å—ã –ø–æ —ç–∫–æ–ª–æ–≥–∏–∏ üíª
–¶–µ–ª–∏:
‚Ä¢ –ü–æ–≤—ã—à–µ–Ω–∏–µ –æ—Å–≤–µ–¥–æ–º–ª–µ–Ω–Ω–æ—Å—Ç–∏ üì¢
‚Ä¢ –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –∫—É–ª—å—Ç—É—Ä—ã üå±
‚Ä¢ –ú–æ—Ç–∏–≤–∞—Ü–∏—è –∫ –¥–µ–π—Å—Ç–≤–∏—é ‚ú®""",
                reply_markup=ways_keyboard(),
                parse_mode="Markdown"
            )
        elif text == "‚ö°Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏":
            try:
                img4 = open("4.jpg", "rb")
                bot.send_photo(message.chat.id, img4)
            except:
                pass
            safe_send_message(
                message.chat.id,
                """
‚ö°Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏ ‚öôÔ∏èüí°

–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ ‚Äî –∫–ª—é—á –∫ —É—Å—Ç–æ–π—á–∏–≤–æ–º—É –±—É–¥—É—â–µ–º—É! üéØüîíüå´

–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
‚Ä¢ –£–ª–∞–≤–ª–∏–≤–∞–Ω–∏–µ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —É–≥–ª–µ—Ä–æ–¥–∞ üè≠
‚Ä¢ –í–æ–¥–æ—Ä–æ–¥–Ω–∞—è —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞ üîµ
‚Ä¢ –£–º–Ω—ã–µ —Å–µ—Ç–∏ —ç–Ω–µ—Ä–≥–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è üîå
‚Ä¢ –ë–∏–æ—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –¥–ª—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç—Ö–æ–¥–æ–≤ üß™

–ò–Ω–Ω–æ–≤–∞—Ü–∏–∏:
‚Ä¢ –°–æ–ª–Ω–µ—á–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è ‚òÄÔ∏è
‚Ä¢ –≠–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã üèó
‚Ä¢ –≠–ª–µ–∫—Ç—Ä–æ–º–æ–±–∏–ª–∏ –∏ –ó–ó–ó üöó""",
                reply_markup=ways_keyboard(),
                parse_mode="Markdown"
            )
        elif text == "üóë –£–º–µ–Ω—å—à–µ–Ω–∏–µ –æ—Ç—Ö–æ–¥–æ–≤":
            try:
                img5 = open("5.jpg", "rb")
                bot.send_photo(message.chat.id, img5)
            except:
                pass
            safe_send_message(
                message.chat.id,
                """
üóë –£–º–µ–Ω—å—à–µ–Ω–∏–µ –æ—Ç—Ö–æ–¥–æ–≤ üìâ

–ú–µ–Ω—å—à–µ –º—É—Å–æ—Ä–∞ ‚Äî —á–∏—â–µ –ø–ª–∞–Ω–µ—Ç–∞! ‚ôªÔ∏èüåç

–ü—Ä–∏–Ω—Ü–∏–ø—ã:
‚Ä¢ Reduce (—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ) üõç
‚Ä¢ Reuse (–ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ) üîÑ
‚Ä¢ Recycle (–ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞) ‚ôªÔ∏è

–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
‚Ä¢ –û—Ç–∫–∞–∑ –æ—Ç –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ –ø–ª–∞—Å—Ç–∏–∫–∞ ü•§üö´
‚Ä¢ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –º—É—Å–æ—Ä–∞ üóÇ
‚Ä¢ –ö–æ–º–ø–æ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏—Ö –æ—Ç—Ö–æ–¥–æ–≤ üçÇ
‚Ä¢ –ü–æ–∫—É–ø–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –±–µ–∑ —É–ø–∞–∫–æ–≤–∫–∏ üõí""",
                reply_markup=ways_keyboard(),
                parse_mode="Markdown"
            )
        elif text == "üèò –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã":
            try:
                img6 = open("6.jpg", "rb")
                bot.send_photo(message.chat.id, img6)
            except:
                pass
            safe_send_message(
                message.chat.id,
                """
üèò –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã ‚úä

–ë–æ–ª—å—à–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å –º–∞–ª–æ–≥–æ! üåü

–ü—Ä–∏–º–µ—Ä—ã –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π:
‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ –∑–µ–ª–µ–Ω—ã—Ö –∑–æ–Ω –≤ –≥–æ—Ä–æ–¥–∞—Ö üåøüèû
‚Ä¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å—É–±–±–æ—Ç–Ω–∏–∫–æ–≤ üßπ
‚Ä¢ –ü–æ—Å–∞–¥–∫–∞ –¥–µ—Ä–µ–≤—å–µ–≤ –≤ —Ä–∞–π–æ–Ω–µ üå±üå≥
‚Ä¢ –≠–∫–æ–ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏–µ —Å–æ—Å–µ–¥–µ–π üë•
‚Ä¢ –†–∞–∑–¥–µ–ª—å–Ω—ã–π —Å–±–æ—Ä –æ—Ç—Ö–æ–¥–æ–≤ üóë

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
‚Ä¢ –ë—ã—Å—Ç—Ä—ã–π –≤–∏–¥–∏–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚úÖ
‚Ä¢ –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ ü§ù
‚Ä¢ –£–ª—É—á—à–µ–Ω–∏–µ –º–µ—Å—Ç–Ω–æ–π —ç–∫–æ–ª–æ–≥–∏–∏ üè°""",
                reply_markup=ways_keyboard(),
                parse_mode="Markdown"
            )
        else:
            safe_send_message(
                message.chat.id,
                "–Ø –Ω–µ –ø–æ–Ω—è–ª –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ü§î\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é üëá",
                reply_markup=main_keyboard()
            )
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –≤ handle_buttons: {e}")
        safe_send_message(
            message.chat.id,
            "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ üòî\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ üëá",
            reply_markup=main_keyboard()
        )

if name == "main":
    
    while True:
        try:
            bot.polling(none_stop=True, timeout=60)
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –±–æ—Ç–∞: {e}")
            print("üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥...")
            time.sleep(10)